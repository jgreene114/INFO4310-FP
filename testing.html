<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Text Transition</title>
    <style>
        .text-container {
            position: relative;
            width: 300px;
            height: 50px;
            overflow: hidden;
            font-size: 24px;
            text-align: center;
            line-height: 50px; /* Vertically center text in the div */
        }

        .text {
            position: absolute;
            width: 100%;
            opacity: 0; /* Start invisible to allow for fadeIn */
            transition: transform 1s, opacity 1s;
        }
    </style>
</head>
<body>
<div id="mydiv" class="text-container">
    <div class="text">hello!</div>
</div>
<button onclick="updateText(d3.select('#mydiv'), 'New Message!')">Update Text</button>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
    // function setupContainer(container) {
    //     // Initialize the container with a text element if it does not exist
    //     if (container.select(".text").empty()) {
    //         container.append("div")
    //             .attr("class", "text")
    //             .style("opacity", "0");  // Start with the text invisible
    //     }
    // }

    function updateText(container, newText) {
        // setupContainer(container);  // Ensure the container is properly setup

        const currentText = container.select(".text");
        const initialOpacity = currentText.style("opacity");

        if (initialOpacity === "0") {  // If there's no text visible currently
            // Directly fade in the new text
            currentText.text(newText)
                .transition()
                .duration(200)
                .style("opacity", "1");
        } else {
            // Create a new text div for the incoming text
            const newTextDiv = container.append("div")
                .classed("old-text", false)
                .attr("class", "text")
                .text(newText)
                .style("transform", "translateY(18px) rotateX(-90deg) scale(1.2, 1)")  // Start below the current text

            // Fade out and slide up the current text
            currentText
                .classed("old-text", true)
                .transition()
                .duration(1000)
                .style("transform", "translateY(-18px) rotateX(90deg)")
                .style("opacity", "0")

            // currentText.on('end', (event) => {
            //     // .on("end", function () {
            //         console.log(event)
            //         currentText.remove();  // Remove the old text div after transition
            //
            // })
                // });

            // Fade in the new text
            newTextDiv.transition()
                .duration(1000)
                .style("transform", "translateY(0px) rotateX(0deg)")
                .style("opacity", "1")

            newTextDiv.delay(100)
                .on("start", () => {
                    currentText.remove()
                })
        }
    }
</script>
</body>
</html>
